<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>情感分类问题 | superzhaoyang</title><meta name="description" content="情感分类问题"><meta name="keywords" content="deep learning,Pytorch"><meta name="author" content="superzhaoyang"><meta name="copyright" content="superzhaoyang"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="情感分类问题"><meta name="twitter:description" content="情感分类问题"><meta name="twitter:image" content="https://s1.ax1x.com/2020/06/02/tNgGxf.png"><meta property="og:type" content="article"><meta property="og:title" content="情感分类问题"><meta property="og:url" content="http://yoursite.com/2020/06/02/情感分类问题/"><meta property="og:site_name" content="superzhaoyang"><meta property="og:description" content="情感分类问题"><meta property="og:image" content="https://s1.ax1x.com/2020/06/02/tNgGxf.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'true'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/fonts/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.css"><link rel="canonical" href="http://yoursite.com/2020/06/02/情感分类问题/"><link rel="next" title="Deep Reinforcement Learning" href="http://yoursite.com/2020/05/12/Deep-Reinforcement-Learning/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://www.superzhaoyang.top/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: {"text":"superzhaoyang,帅,聪明,IT,敲代码,LOL,玩,酷,绚,NB,乒乓球,付同有我儿子","fontSize":"15px"},
  medium_zoom: 'true',
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"Press","message_next":"to bookmark this page"},"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Light Mode Activated Manually","night_to_day":"Dark Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"}
  
}</script></head><body><canvas class="fireworks"></canvas><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">superzhaoyang</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 学习和娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/book/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li></ul></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> Search</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="https://s2.ax1x.com/2019/09/10/naEP1g.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">61</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">85</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 档案</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 学习和娱乐</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/book/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#二、词袋模型"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">二、词袋模型</span></a></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#二、词袋模型"><span class="toc-number">1.</span> <span class="toc-text">二、词袋模型</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://s1.ax1x.com/2020/06/02/tNgGxf.png)"><div id="post-info"><div id="post-title"><div class="posttitle">情感分类问题</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2020-06-02<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-06-02</time><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>Post View: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>​     本想目以爬取京东的评论入手，对其中的好评和差评做情感分析。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 导入程序所需要的程序包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#抓取网页内容用的程序包</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment">#PyTorch用的包</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim</span><br><span class="line"><span class="comment">#from torch.autograd import Variable</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自然语言处理相关的包</span></span><br><span class="line"><span class="keyword">import</span> re <span class="comment">#正则表达式的包</span></span><br><span class="line"><span class="keyword">import</span> jieba <span class="comment">#结巴分词包</span></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter <span class="comment">#搜集器，可以让统计词频更简单</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘图、计算用的程序包</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">%matplotlib inline</span><br></pre></td></tr></table></figure>

<p>一.数据爬取</p>
<p>1.从京东上爬取评论</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 在指定的url处获得评论</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_comments</span><span class="params">(url)</span>:</span></span><br><span class="line">    comments = []</span><br><span class="line">    <span class="comment"># 打开指定页面</span></span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    resp.encoding = <span class="string">'gbk'</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#如果200秒没有打开则失败</span></span><br><span class="line">    <span class="keyword">if</span> resp.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获得内容</span></span><br><span class="line">    content = resp.text</span><br><span class="line">    <span class="keyword">if</span> content:</span><br><span class="line">        <span class="comment">#获得（）括号中的内容</span></span><br><span class="line">        ind = content.find(<span class="string">'('</span>)</span><br><span class="line">        s1 = content[ind+<span class="number">1</span>:<span class="number">-2</span>]</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment">#尝试利用jason接口来读取内容，并做jason的解析</span></span><br><span class="line">            js = json.loads(s1)</span><br><span class="line">            <span class="comment">#提取出comments字段的内容</span></span><br><span class="line">            comment_infos = js[<span class="string">'comments'</span>]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            print(<span class="string">'error'</span>)</span><br><span class="line">            <span class="keyword">return</span>([])</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#对每一条评论进行内容部分的抽取</span></span><br><span class="line">        <span class="keyword">for</span> comment_info <span class="keyword">in</span> comment_infos:</span><br><span class="line">            comment_content = comment_info[<span class="string">'content'</span>]</span><br><span class="line">            str1 = comment_content + <span class="string">'\n'</span></span><br><span class="line">            comments.append(str1)</span><br><span class="line">    <span class="keyword">return</span> comments</span><br><span class="line"></span><br><span class="line">good_comments = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#评论抓取的来源地址，其中参数包括：</span></span><br><span class="line"><span class="comment">#productId为商品的id，score为评分，page为对应的评论翻页的页码，pageSize为总页数</span></span><br><span class="line"><span class="comment">#这里，我们设定score＝3表示好的评分。</span></span><br><span class="line">good_comment_url_templates = [</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv8914&amp;productId=10359162198&amp;score=3&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv73&amp;productId=10968941641&amp;score=3&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv4653&amp;productId=10335204102&amp;score=3&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv1&amp;productId=1269194114&amp;score=3&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv2777&amp;productId=1409704820&amp;score=3&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv174&amp;productId=10103790891&amp;score=3&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv9447&amp;productId=1708318938&amp;score=3&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv111&amp;productId=10849803616&amp;score=3&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对上述网址进行循环，并模拟翻页100次</span></span><br><span class="line">j=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> good_comment_url_template <span class="keyword">in</span> good_comment_url_templates:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        url = good_comment_url_template.format(i)</span><br><span class="line">        good_comments += get_comments(url)</span><br><span class="line">        print(<span class="string">'第&#123;&#125;条纪录，总文本长度&#123;&#125;'</span>.format(j, len(good_comments)))</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        print(good_comments)</span><br><span class="line"><span class="comment">#将结果存储到good.txt文件中</span></span><br><span class="line">fw = open(<span class="string">'data/good.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">fw.writelines(good_comments)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 负向评论如法炮制</span></span><br><span class="line">bad_comments = []</span><br><span class="line">bad_comment_url_templates = [</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv8914&amp;productId=10359162198&amp;score=1&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv73&amp;productId=10968941641&amp;score=1&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'http://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv4653&amp;productId=10335204102&amp;score=1&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv1&amp;productId=1269194114&amp;score=1&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv2777&amp;productId=1409704820&amp;score=1&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv174&amp;productId=10103790891&amp;score=1&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv9447&amp;productId=1708318938&amp;score=1&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span>,</span><br><span class="line">    <span class="string">'https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98vv111&amp;productId=10849803616&amp;score=1&amp;sortType=5&amp;page=&#123;&#125;&amp;pageSize=10&amp;isShadowSku=0'</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> bad_comment_url_template <span class="keyword">in</span> bad_comment_url_templates:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        url = bad_comment_url_template.format(i)</span><br><span class="line">        bad_comments += get_comments(url)</span><br><span class="line">        print(<span class="string">'第&#123;&#125;条纪录，总文本长度&#123;&#125;'</span>.format(j, len(bad_comments)))</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">fw = open(<span class="string">'data/bad.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">fw.writelines(bad_comments)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>数据预处理</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数据来源文件</span></span><br><span class="line">good_file = <span class="string">'data/good.txt'</span></span><br><span class="line">bad_file  = <span class="string">'data/bad.txt'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将文本中的标点符号过滤掉</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">filter_punc</span><span class="params">(sentence)</span>:</span></span><br><span class="line">    sentence = re.sub(<span class="string">"[\s+\.\!\/_,$%^*(+\"\'“”《》?“]+|[+——！，。？、~@#￥%……&amp;*（）：]+"</span>, <span class="string">""</span>, sentence)  </span><br><span class="line">    <span class="keyword">return</span>(sentence)</span><br><span class="line"></span><br><span class="line"><span class="comment">#扫描所有的文本，分词、建立词典，分出正向还是负向的评论，is_filter可以过滤是否筛选掉标点符号</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Prepare_data</span><span class="params">(good_file, bad_file, is_filter = True)</span>:</span></span><br><span class="line">    all_words = [] <span class="comment">#存储所有的单词</span></span><br><span class="line">    pos_sentences = [] <span class="comment">#存储正向的评论</span></span><br><span class="line">    neg_sentences = [] <span class="comment">#存储负向的评论</span></span><br><span class="line">    <span class="keyword">with</span> open(good_file, <span class="string">'r'</span>) <span class="keyword">as</span> fr:</span><br><span class="line">        <span class="keyword">for</span> idx, line <span class="keyword">in</span> enumerate(fr):</span><br><span class="line">            <span class="keyword">if</span> is_filter:</span><br><span class="line">                <span class="comment">#过滤标点符号</span></span><br><span class="line">                line = filter_punc(line)</span><br><span class="line">            <span class="comment">#分词</span></span><br><span class="line">            words = jieba.lcut(line)</span><br><span class="line">            <span class="keyword">if</span> len(words) &gt; <span class="number">0</span>:</span><br><span class="line">                all_words += words</span><br><span class="line">                pos_sentences.append(words)</span><br><span class="line">    print(<span class="string">'&#123;0&#125; 包含 &#123;1&#125; 行, &#123;2&#125; 个词.'</span>.format(good_file, idx+<span class="number">1</span>, len(all_words)))</span><br><span class="line"></span><br><span class="line">    count = len(all_words)</span><br><span class="line">    <span class="keyword">with</span> open(bad_file, <span class="string">'r'</span>) <span class="keyword">as</span> fr:</span><br><span class="line">        <span class="keyword">for</span> idx, line <span class="keyword">in</span> enumerate(fr):</span><br><span class="line">            <span class="keyword">if</span> is_filter:</span><br><span class="line">                line = filter_punc(line)</span><br><span class="line">            words = jieba.lcut(line)</span><br><span class="line">            <span class="keyword">if</span> len(words) &gt; <span class="number">0</span>:</span><br><span class="line">                all_words += words</span><br><span class="line">                neg_sentences.append(words)</span><br><span class="line">    print(<span class="string">'&#123;0&#125; 包含 &#123;1&#125; 行, &#123;2&#125; 个词.'</span>.format(bad_file, idx+<span class="number">1</span>, len(all_words)-count))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#建立词典，diction的每一项为&#123;w:[id, 单词出现次数]&#125;</span></span><br><span class="line">    diction = &#123;&#125;</span><br><span class="line">    cnt = Counter(all_words)</span><br><span class="line">    <span class="keyword">for</span> word, freq <span class="keyword">in</span> cnt.items():</span><br><span class="line">        diction[word] = [len(diction), freq]</span><br><span class="line">    print(<span class="string">'字典大小：&#123;&#125;'</span>.format(len(diction)))</span><br><span class="line">    <span class="keyword">return</span>(pos_sentences, neg_sentences, diction)</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据单词返还单词的编码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">word2index</span><span class="params">(word, diction)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> word <span class="keyword">in</span> diction:</span><br><span class="line">        value = diction[word][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        value = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">return</span>(value)</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据编码获得单词</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index2word</span><span class="params">(index, diction)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> w,v <span class="keyword">in</span> diction.items():</span><br><span class="line">        <span class="keyword">if</span> v[<span class="number">0</span>] == index:</span><br><span class="line">            <span class="keyword">return</span>(w)</span><br><span class="line">    <span class="keyword">return</span>(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">pos_sentences, neg_sentences, diction = Prepare_data(good_file, bad_file, <span class="literal">True</span>)</span><br><span class="line">st = sorted([(v[<span class="number">1</span>], w) <span class="keyword">for</span> w, v <span class="keyword">in</span> diction.items()])</span><br><span class="line">st</span><br></pre></td></tr></table></figure>

<h2 id="二、词袋模型"><a href="#二、词袋模型" class="headerlink" title="二、词袋模型"></a>二、词袋模型</h2><p>词袋模型实际上是一种对文本进行向量化的手段，通过统计出词表上的每个单词出现频率，从而将一篇文章向量化</p>
<ol>
<li>训练数据准备</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 输入一个句子和相应的词典，得到这个句子的向量化表示</span></span><br><span class="line"><span class="comment"># 向量的尺寸为词典中词汇的个数，i位置上面的数值为第i个单词在sentence中出现的频率</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sentence2vec</span><span class="params">(sentence, dictionary)</span>:</span></span><br><span class="line">    vector = np.zeros(len(dictionary))</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> sentence:</span><br><span class="line">        vector[l] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span>(<span class="number">1.0</span> * vector / len(sentence))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历所有句子，将每一个词映射成编码</span></span><br><span class="line">dataset = [] <span class="comment">#数据集</span></span><br><span class="line">labels = [] <span class="comment">#标签</span></span><br><span class="line">sentences = [] <span class="comment">#原始句子，调试用</span></span><br><span class="line"><span class="comment"># 处理正向评论</span></span><br><span class="line"><span class="keyword">for</span> sentence <span class="keyword">in</span> pos_sentences:</span><br><span class="line">    new_sentence = []</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> sentence:</span><br><span class="line">        <span class="keyword">if</span> l <span class="keyword">in</span> diction:</span><br><span class="line">            new_sentence.append(word2index(l, diction))</span><br><span class="line">    dataset.append(sentence2vec(new_sentence, diction))</span><br><span class="line">    labels.append(<span class="number">0</span>) <span class="comment">#正标签为0</span></span><br><span class="line">    sentences.append(sentence)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理负向评论</span></span><br><span class="line"><span class="keyword">for</span> sentence <span class="keyword">in</span> neg_sentences:</span><br><span class="line">    new_sentence = []</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> sentence:</span><br><span class="line">        <span class="keyword">if</span> l <span class="keyword">in</span> diction:</span><br><span class="line">            new_sentence.append(word2index(l, diction))</span><br><span class="line">    dataset.append(sentence2vec(new_sentence, diction))</span><br><span class="line">    labels.append(<span class="number">1</span>) <span class="comment">#负标签为1</span></span><br><span class="line">    sentences.append(sentence)</span><br><span class="line"></span><br><span class="line"><span class="comment">#打乱所有的数据顺序，形成数据集</span></span><br><span class="line"><span class="comment"># indices为所有数据下标的一个全排列</span></span><br><span class="line">indices = np.random.permutation(len(dataset))</span><br><span class="line"></span><br><span class="line"><span class="comment">#重新根据打乱的下标生成数据集dataset，标签集labels，以及对应的原始句子sentences</span></span><br><span class="line">dataset = [dataset[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices]</span><br><span class="line">labels = [labels[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices]</span><br><span class="line">sentences = [sentences[i] <span class="keyword">for</span> i <span class="keyword">in</span> indices]</span><br><span class="line"></span><br><span class="line"><span class="comment">#对整个数据集进行划分，分为：训练集、校准集和测试集，其中校准和测试集合的长度都是整个数据集的10分之一</span></span><br><span class="line">test_size = len(dataset) // <span class="number">10</span></span><br><span class="line">train_data = dataset[<span class="number">2</span> * test_size :]</span><br><span class="line">train_label = labels[<span class="number">2</span> * test_size :]</span><br><span class="line"></span><br><span class="line">valid_data = dataset[: test_size]</span><br><span class="line">valid_label = labels[: test_size]</span><br><span class="line"></span><br><span class="line">test_data = dataset[test_size : <span class="number">2</span> * test_size]</span><br><span class="line">test_label = labels[test_size : <span class="number">2</span> * test_size]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>模型定义</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 一个简单的前馈神经网络，三层，第一层线性层，加一个非线性ReLU，第二层线性层，中间有10个隐含层神经元</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入维度为词典的大小：每一段评论的词袋模型</span></span><br><span class="line">model = nn.Sequential(</span><br><span class="line">    nn.Linear(len(diction), <span class="number">10</span>),</span><br><span class="line">    nn.ReLU(),</span><br><span class="line">    nn.Linear(<span class="number">10</span>, <span class="number">2</span>),</span><br><span class="line">    nn.LogSoftmax(),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rightness</span><span class="params">(predictions, labels)</span>:</span></span><br><span class="line">    <span class="string">"""计算预测错误率的函数，其中predictions是模型给出的一组预测结果，batch_size行num_classes列的矩阵，labels是数据之中的正确答案"""</span></span><br><span class="line">    pred = torch.max(predictions.data, <span class="number">1</span>)[<span class="number">1</span>] <span class="comment"># 对于任意一行（一个样本）的输出值的第1个维度，求最大，得到每一行的最大元素的下标</span></span><br><span class="line">    rights = pred.eq(labels.data.view_as(pred)).sum() <span class="comment">#将下标与labels中包含的类别进行比较，并累计得到比较正确的数量</span></span><br><span class="line">    <span class="keyword">return</span> rights, len(labels) <span class="comment">#返回正确的数量和这一次一共比较了多少元素</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>训练模型</li>
</ol>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 损失函数为交叉熵</span></span><br><span class="line">cost = torch.nn.NLLLoss()</span><br><span class="line"><span class="comment"># 优化算法为Adam，可以自动调节学习率</span></span><br><span class="line">optimizer = torch.optim.Adam(model.parameters(), lr = <span class="number">0.01</span>)</span><br><span class="line">records = []</span><br><span class="line"></span><br><span class="line"><span class="comment">#循环10个Epoch</span></span><br><span class="line">losses = []</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> i, data <span class="keyword">in</span> enumerate(zip(train_data, train_label)):</span><br><span class="line">        x, y = data</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 需要将输入的数据进行适当的变形，主要是要多出一个batch_size的维度，也即第一个为1的维度</span></span><br><span class="line">        x = torch.tensor(x, requires_grad = <span class="literal">True</span>, dtype = torch.float).view(<span class="number">1</span>,<span class="number">-1</span>)</span><br><span class="line">        <span class="comment"># x的尺寸：batch_size=1, len_dictionary</span></span><br><span class="line">        <span class="comment"># 标签也要加一层外衣以变成1*1的张量</span></span><br><span class="line">        y = torch.tensor(np.array([y]), dtype = torch.long)</span><br><span class="line">        <span class="comment"># y的尺寸：batch_size=1, 1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 清空梯度</span></span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        <span class="comment"># 模型预测</span></span><br><span class="line">        predict = model(x)</span><br><span class="line">        <span class="comment"># 计算损失函数</span></span><br><span class="line">        loss = cost(predict, y)</span><br><span class="line">        <span class="comment"># 将损失函数数值加入到列表中</span></span><br><span class="line">        losses.append(loss.data.numpy())</span><br><span class="line">        <span class="comment"># 开始进行梯度反传</span></span><br><span class="line">        loss.backward()</span><br><span class="line">        <span class="comment"># 开始对参数进行一步优化</span></span><br><span class="line">        optimizer.step()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 每隔3000步，跑一下校验数据集的数据，输出临时结果</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">3000</span> == <span class="number">0</span>:</span><br><span class="line">            val_losses = []</span><br><span class="line">            rights = []</span><br><span class="line">            <span class="comment"># 在所有校验数据集上实验</span></span><br><span class="line">            <span class="keyword">for</span> j, val <span class="keyword">in</span> enumerate(zip(valid_data, valid_label)):</span><br><span class="line">                x, y = val</span><br><span class="line">                x = torch.tensor(x, requires_grad = <span class="literal">True</span>, dtype = torch.float).view(<span class="number">1</span>,<span class="number">-1</span>)</span><br><span class="line">                y = torch.tensor(np.array([y]), dtype = torch.long)</span><br><span class="line">                predict = model(x)</span><br><span class="line">                <span class="comment"># 调用rightness函数计算准确度</span></span><br><span class="line">                right = rightness(predict, y)</span><br><span class="line">                rights.append(right)</span><br><span class="line">                loss = cost(predict, y)</span><br><span class="line">                val_losses.append(loss.data.numpy())</span><br><span class="line">                </span><br><span class="line">            <span class="comment"># 将校验集合上面的平均准确度计算出来</span></span><br><span class="line">            right_ratio = <span class="number">1.0</span> * np.sum([i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> rights]) / np.sum([i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> rights])</span><br><span class="line">            print(<span class="string">'第&#123;&#125;轮，训练损失：&#123;:.2f&#125;, 校验损失：&#123;:.2f&#125;, 校验准确率: &#123;:.2f&#125;'</span>.format(epoch, np.mean(losses),</span><br><span class="line">                                                                        np.mean(val_losses), right_ratio))</span><br><span class="line">            records.append([np.mean(losses), np.mean(val_losses), right_ratio])</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 绘制误差曲线</span></span><br><span class="line">a = [i[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> records]</span><br><span class="line">b = [i[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> records]</span><br><span class="line">c = [i[<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> records]</span><br><span class="line">plt.plot(a, label = <span class="string">'Train Loss'</span>)</span><br><span class="line">plt.plot(b, label = <span class="string">'Valid Loss'</span>)</span><br><span class="line">plt.plot(c, label = <span class="string">'Valid Accuracy'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Steps'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Loss &amp; Accuracy'</span>)</span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure>

<p><img alt data-src="https://s1.ax1x.com/2020/06/02/tNgGxf.png" class="lazyload"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在测试集上分批运行，并计算总的正确率</span></span><br><span class="line">vals = [] <span class="comment">#记录准确率所用列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对测试数据集进行循环</span></span><br><span class="line"><span class="keyword">for</span> data, target <span class="keyword">in</span> zip(test_data, test_label):</span><br><span class="line">    data, target = torch.tensor(data, dtype = torch.float).view(<span class="number">1</span>,<span class="number">-1</span>), torch.tensor(np.array([target]), dtype = torch.long)</span><br><span class="line">    output = model(data) <span class="comment">#将特征数据喂入网络，得到分类的输出</span></span><br><span class="line">    val = rightness(output, target) <span class="comment">#获得正确样本数以及总样本数</span></span><br><span class="line">    vals.append(val) <span class="comment">#记录结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#计算准确率</span></span><br><span class="line">rights = (sum([tup[<span class="number">0</span>] <span class="keyword">for</span> tup <span class="keyword">in</span> vals]), sum([tup[<span class="number">1</span>] <span class="keyword">for</span> tup <span class="keyword">in</span> vals]))</span><br><span class="line">right_rate = <span class="number">1.0</span> * rights[<span class="number">0</span>].data.numpy() / rights[<span class="number">1</span>]</span><br><span class="line">right_rate</span><br></pre></td></tr></table></figure>

<p>right_rate = 0.8971603990790483</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">superzhaoyang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/06/02/情感分类问题/">http://yoursite.com/2020/06/02/情感分类问题/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/deep-learning/">deep learning    </a><a class="post-meta__tags" href="/tags/Pytorch/">Pytorch    </a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/06/02/tNgGxf.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button"><i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2020/05/12/Deep-Reinforcement-Learning/"><img class="next_cover lazyload" data-src="https://s1.ax1x.com/2020/05/12/YUapGV.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>Deep Reinforcement Learning</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/03/22/循环神经网络/" title="循环神经网络RNN"><img class="relatedPosts_cover lazyload" data-src="https://s1.ax1x.com/2020/03/22/84fiEd.png"><div class="relatedPosts_title">循环神经网络RNN</div></a></div><div class="relatedPosts_item"><a href="/2020/03/15/卷积神经网络实战之Lenet5-Resnet/" title="卷积神经网络实战之Lenet5 & Resnet"><img class="relatedPosts_cover lazyload" data-src="https://s1.ax1x.com/2020/03/15/88wucj.png"><div class="relatedPosts_title">卷积神经网络实战之Lenet5 & Resnet</div></a></div><div class="relatedPosts_item"><a href="/2020/05/11/NPLM&&word2vec/" title="NPLM与word2vec实战"><img class="relatedPosts_cover lazyload" data-src="https://s1.ax1x.com/2020/05/11/YGUNJe.png"><div class="relatedPosts_title">NPLM与word2vec实战</div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'REItCuJxdP5eRCIkGnFNRGWt-gzGzoHsz',
  appKey:'CdrBY5eDdonSzQutnKqm0fBv',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></div><footer id="footer" style="background-image: url(https://s1.ax1x.com/2020/06/02/tNgGxf.png)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By superzhaoyang</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi,  welcome  to  my  <a href="https://superzhaoyang.top/">blog</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script async src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zindex="-1" mobile="true" data-click="true"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/baidupush.js"> </script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async></script><script src="/js/third-party/click_heart.js"></script><script src="/js/third-party/ClickShowText.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>